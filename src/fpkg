#!/bin/bash
_PKGDIR="$FPKG_ROOT/var/pkg"
_GITDIR="$FPKG_ROOT/var/fpkg/git"
REPO="https://github.com/Ohio2/frepo.git"
_lock="/tmp/lock"
if [ -f $lock ]; then
	echo "Error 5"
	exit 5
fi
touch $_lock
if [ ! -d $_GITDIR ]; then
	git clone $REPO $_GITDIR
fi
cd $_GITDIR
git pull
cd $OLDPWD
if [ ! -d $_PKGDIR ]; then
	mkdir -pv $_PKGDIR
fi
case $1 in
	i|install) while [ ! -z "$2" ]; do PKGDIR=$_PKGDIR GITDIR=$_GITDIR spkg "$2" ; PKGDIR=$_PKGDIR ipkg "$2" ; PKGDIR=$_PKGDIR GITDIR=$_GITDIR spkg < $2.d ; PKGDIR=$_PKGDIR ipkg < $2.d ; shift; done ;;
	u|update) while [ ! -z "$2" ]; do  PKGDIR=$_PKGDIR GITDIR=$_GITDIR upkg "$2"; shift; done ;;
	l|list) while [ ! -z "$2" ]; do PKGDIR=$_PKGDIR lpkg "$2"; shift; done ;;
	q|query) while [ ! -z "$2" ]; do PKGDIR=$_PKGDIR qpkg "$2"; shift; done ;;
	r|remove) while [ ! -z "$2" ]; do PKGDIR=$_PKGDIR rpkg "$2"; shift; done ;;
	s|sync) while [ ! -z "$2" ]; do  PKGDIR=$_PKGDIR GITDIR=$_GITDIR spkg "$2"; shift; done ;;
	c|create|src|compile|make|source) PKGDIR=$_PKGDIR cpkg "$2" "$3" "$4" ;;
	sq|syncquery) while [ ! -z "$2" ]; do PKGDIR=$_PKGDIR GITDIR=$_GITDIR spkg --query "$2" ; shift ; done ;;
esac
rm $_lock
